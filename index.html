<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El cuervo Turr√°n</title>
<style>
  body { margin:0; background:#111; font-family:sans-serif; }
  #game { display:none; background:#6ec6ff; margin:auto; border:3px solid #000; border-radius:10px; }
  #pad { display:none; position:fixed; bottom:20px; left:0; right:0; display:flex; justify-content:center; gap:20px; }
  #pad button { width:80px; height:80px; font-size:32px; border-radius:20px; border:none; background:#333; color:white; }
  #intro, #gameover { position:fixed; top:0; left:0; right:0; bottom:0; display:flex; flex-direction:column; justify-content:center; align-items:center; background:#000; color:#fff; z-index:5; }
  #intro h1 { font-size:42px; margin-bottom:20px; }
  #intro img { max-width:300px; border-radius:12px; margin-bottom:20px; }
  #intro button, #gameover button { padding:12px 24px; font-size:22px; margin-top:20px; }
  #gameover h1 { font-size:40px; color:red; margin-bottom:20px; text-align:center; }
</style>
</head>
<body>

<!-- Intro -->
<div id="intro">
  <h1>üê¶ El cuervo Turr√°n üê¶</h1>
  <img src="turran_moto.png" alt="Turr√°n en moto">
  <button onclick="startGame()">Comenzar</button>
</div>

<!-- Canvas del juego -->
<canvas id="game" width="800" height="400"></canvas>

<!-- Botones t√°ctiles -->
<div id="pad">
  <button id="left">‚óÄ</button>
  <button id="jump">‚¨Ü</button>
  <button id="right">‚ñ∂</button>
</div>

<!-- Pantalla Game Over -->
<div id="gameover" style="display:none;">
  <h1>Game Over<br>Esto y lo Otro</h1>
  <button onclick="restartGame()">Reintentar</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
let keys={},player,enemies,camX,running;
let music;

const imgPlayer=new Image();
imgPlayer.src="turran_sprite.png";  // sprite del cuervo
const imgEnemy=new Image();
imgEnemy.src="txibiri.png";         // enemigo

function playMusic(){
  music=new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg");
  music.loop=true; music.volume=0.4;
  music.play().catch(()=>{});
}

function resetPlayer(){
  player={x:100,y:320,vx:0,vy:0,w:64,h:64,dir:1,onGround:false};
}

function spawnEnemy(){
  enemies.push({x:camX+canvas.width+100,y:320,alive:true});
}

function startGame(){
  document.getElementById("intro").style.display="none";
  document.getElementById("game").style.display="block";
  document.getElementById("pad").style.display="flex";
  document.getElementById("gameover").style.display="none";
  resetPlayer(); enemies=[]; camX=0; running=true;
  playMusic();
  loop();
}

function restartGame(){ startGame(); }

// Input teclado
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);
// Input t√°ctil
document.getElementById("left").onmousedown=()=>keys["ArrowLeft"]=true;
document.getElementById("right").onmousedown=()=>keys["ArrowRight"]=true;
document.getElementById("jump").onmousedown=()=>keys["ArrowUp"]=true;
document.querySelectorAll("#pad button").forEach(b=>b.onmouseup=()=>{keys["ArrowLeft"]=keys["ArrowRight"]=keys["ArrowUp"]=false;});

function loop(){ if(!running) return; update(); draw(); requestAnimationFrame(loop); }

function update(){
  if(keys["ArrowLeft"]){player.vx=-3; player.dir=-1;}
  else if(keys["ArrowRight"]){player.vx=3; player.dir=1;}
  else player.vx=0;
  if(keys["ArrowUp"]&&player.onGround){player.vy=-10; player.onGround=false;}

  player.vy+=0.5; player.x+=player.vx; player.y+=player.vy;
  if(player.y>=320){player.y=320; player.vy=0; player.onGround=true;}

  camX=player.x-100;
  if(Math.random()<0.02) spawnEnemy();
  enemies.forEach(e=>e.x-=3);

  for(const e of enemies){
    if(player.x<e.x+48&&player.x+48>e.x&&player.y<e.y+48&&player.y+48>e.y){
      running=false;
      document.getElementById("gameover").style.display="flex";
    }
  }
}

function draw(){
  ctx.fillStyle="#6ec6ff"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#654321"; ctx.fillRect(0,360,canvas.width,40);

  if(imgPlayer.complete){
    const dw=player.w*2,dh=player.h*2;
    ctx.save();
    ctx.translate(Math.floor(player.x-camX)+(player.dir===-1?dw:0),player.y-dh+player.h);
    ctx.scale(player.dir,1);
    ctx.drawImage(imgPlayer,0,0,player.w,player.h,0,0,dw,dh);
    ctx.restore();
  }
  for(const e of enemies){
    const x=Math.floor(e.x-camX),y=e.y;
    if(imgEnemy.complete){
      ctx.drawImage(imgEnemy,x,y,48,48);
    } else {
      ctx.fillStyle="red"; ctx.fillRect(x,y,48,48);
    }
  }
}
</script>
</body>
</html>
