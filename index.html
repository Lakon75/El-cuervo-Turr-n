<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>El cuervo Turr√°n</title>
<style>
  body { margin:0; background:#111; display:flex; justify-content:center; align-items:center; height:100vh; }
  #game { background:#6ec6ff; display:block; margin:auto; border:4px solid #000; border-radius:10px; }
  #pad { position:fixed; bottom:20px; left:0; right:0; display:flex; justify-content:center; gap:20px; }
  #pad button { width:80px; height:80px; font-size:32px; border-radius:20px; border:none; background:#333; color:white; }
  #intro, #gameover { position:fixed; top:0; left:0; right:0; bottom:0; display:flex; flex-direction:column; justify-content:center; align-items:center; background:#000; color:#fff; font-family:sans-serif; }
  #intro h1 { font-size:48px; margin-bottom:20px; }
  #intro img { max-width:300px; border-radius:12px; margin-bottom:20px; }
  #intro button { padding:10px 20px; font-size:24px; }
  #gameover h1 { font-size:48px; color:red; }
</style>
</head>
<body>
<div id="intro">
  <h1>üê¶ El cuervo Turr√°n üê¶</h1>
  <img src="turran_moto.png" alt="Turr√°n en moto">
  <button onclick="startGame()">Comenzar</button>
</div>

<canvas id="game" width="800" height="400"></canvas>

<div id="pad" style="display:none;">
  <button id="left">‚óÄ</button>
  <button id="jump">‚¨Ü</button>
  <button id="right">‚ñ∂</button>
</div>

<div id="gameover" style="display:none;">
  <h1>Game Over ‚Äì Esto y lo Otro</h1>
  <button onclick="restartGame()">Reintentar</button>
</div>

<script>
// ====== CONFIG ======
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const SCALE_P = 3;
let keys = {};
let player, enemies, camX, running, gameOver;
let score = 0;

// ====== SPRITES ======
const imgPlayer = new Image();
imgPlayer.src = "turran_sprite.png";

const imgEnemy = new Image();
imgEnemy.src = "txibiri.png"; // tu foto recortada

// ====== MUSICA ======
let music;
function playMusic(){
  if(!music){
    const audio = new Audio("data:audio/mp3;base64,//uQZAAAAAAAA...");
    audio.loop = true;
    audio.volume = 0.3;
    audio.play();
    music = audio;
  }
}

// ====== JUGADOR ======
function resetPlayer(){
  player = {x:100,y:300,vx:0,vy:0,w:64,h:64,dir:1,anim:0,onGround:false};
}

// ====== ENEMIGOS ======
function spawnEnemy(){
  enemies.push({x:camX+canvas.width+100,y:320,alive:true});
}

// ====== GAME ======
function startGame(){
  document.getElementById("intro").style.display="none";
  document.getElementById("pad").style.display="flex";
  resetPlayer();
  enemies=[];
  camX=0; running=true; gameOver=false; score=0;
  playMusic();
  loop();
}

function restartGame(){
  document.getElementById("gameover").style.display="none";
  startGame();
}

// ====== INPUT ======
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

document.getElementById("left").onmousedown=()=>keys["ArrowLeft"]=true;
document.getElementById("right").onmousedown=()=>keys["ArrowRight"]=true;
document.getElementById("jump").onmousedown=()=>keys["ArrowUp"]=true;
document.querySelectorAll("#pad button").forEach(b=>b.onmouseup=()=>keys[b.id==="left"?"ArrowLeft":b.id==="right"?"ArrowRight":"ArrowUp"]=false);

// ====== LOOP ======
function loop(){
  if(!running) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

// ====== UPDATE ======
function update(){
  // movimiento jugador
  if(keys["ArrowLeft"]) player.vx=-3;
  else if(keys["ArrowRight"]) player.vx=3;
  else player.vx=0;

  if(keys["ArrowUp"] && player.onGround){
    player.vy=-10; player.onGround=false;
  }

  player.vy+=0.5;
  player.x+=player.vx;
  player.y+=player.vy;
  if(player.y>=320){ player.y=320; player.vy=0; player.onGround=true; }

  camX=player.x-100;

  // enemigos
  if(Math.random()<0.02) spawnEnemy();
  enemies.forEach(e=>{ e.x-=3; });

  // colisiones
  for(const e of enemies){
    if(e.alive &&
       player.x<e.x+48 && player.x+48>e.x &&
       player.y<e.y+48 && player.y+48>e.y){
      gameOver=true; running=false;
      document.getElementById("gameover").style.display="flex";
    }
  }
}

// ====== DRAW ======
function draw(){
  ctx.fillStyle="#6ec6ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // suelo
  ctx.fillStyle="#654321";
  ctx.fillRect(0,360,canvas.width,40);

  // jugador
  if(imgPlayer.complete){
    const fw=64,fh=64;
    const sx=0,sy=0;
    const dw=fw*SCALE_P,dh=fh*SCALE_P;
    const dx=Math.floor(player.x-camX),dy=player.y-dh+fh;
    ctx.save();
    ctx.translate(dx+(player.dir===-1?dw:0),dy);
    ctx.scale(player.dir,1);
    ctx.drawImage(imgPlayer,sx,sy,fw,fh,0,0,dw,dh);
    ctx.restore();
  }

  // enemigos
  for(const e of enemies){
    const x=Math.floor(e.x-camX),y=e.y;
    if(imgEnemy.complete){
      ctx.save();
      ctx.beginPath();
      ctx.arc(x+24,y+24,24,0,Math.PI*2);
      ctx.clip();
      ctx.drawImage(imgEnemy,x,y,48,48);
      ctx.restore();
      ctx.strokeStyle="#fff"; ctx.lineWidth=2;
      ctx.beginPath(); ctx.arc(x+24,y+24,24,0,Math.PI*2); ctx.stroke();
    } else {
      ctx.fillStyle="red"; ctx.fillRect(x,y,48,48);
    }
  }
}
</script>
</body>
</html>
